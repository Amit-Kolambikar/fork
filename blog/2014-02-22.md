### I Hate Cross-Browser Compatibility: A Website Redesign Gone Wrong

*February 22, 2014*

There comes a time where I get just bored enough that I'm restless and so bored that I'm lazy.  During these times, I write myself a website from scratch.  The last time was around finals season of last year, and it resulted in the first iteration of my personal website (which despite my best intentions was bloated and ugly).  Anyway, it's happened again, and so now I have a new website. Hope you enjoy it!

I had a pretty simple concept for this new site and it didn't take all that long to roll out, but along the way I ran into some pretty funky bugs, many of which almost brought me to tears.

##### The Rotating Tagline

My new website was really supposed to be simple, I swear.  Just my name, how to contact me, and a blog post or three.  After I drew together a mockup however, I quickly began to feel that I needed something more fun.  From that urge came the idea for a rotating tagline.  

The basic pseudo-code for my JavaScript is as follows:

``` pseudocode
every 6 seconds:
    do:
        newSentance := someRandomSentance()
    while numWordsShared(newSentance, currentSentance) < 1

    for each newWord, oldWord in newSentance, currentSentance:
        if newWord != oldWord:
            oldWord.fadeOut()
            containerForWord.resize(newWord.width())
            newWord.fadeIn()

    currentSentance := newSentance
```

Challenges here start with `newWord.width()`.  How do you find the width of arbitrary text in JavaScript?  My first instinct was to write some function that takes the text size and number of characters and interpolates, but as you can imagine this was a nightmare on one browser, nevermind multiple.  Even if I were to have used a fixed width font (I considered it), slight differences in text rendering yield jumps in the animation, or text that is cut off.  No, I'd have to try something else.  

After some creative Googling, I found and adapted a function that calculates text width by creating an invisible text element in the DOM with the same styling as the text in question. Take a look:

```javascript
function calculateWordWidth(text, classes) {
    classes = classes || [];
    classes.push('textDimensionCalculation');
    var div = document.createElement('div');
    div.setAttribute('class', classes.join(' '));
    div.innerHTML = text;
    document.body.appendChild(div);
    var width = jQuery(div).outerWidth(true);
    div.parentNode.removeChild(div);
    return width;
}
```

Fairly straightforward, but definitely non-obvious.  The element is created and given all the classes passed in as well as the `testDimensionCalculation` class, which makes it invisible and absolutely positioned (as to not interfere with any elements the user can see):

```css
.textDimensionCalculation {
    position: absolute;
    visibility: hidden;
    height: auto;
    width: auto;
    display: inline-block;
    white-space: nowrap;
}
```

After the width of the `<div>` is calculated, it is destroyed. 

